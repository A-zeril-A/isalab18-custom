<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- 
        Odoo 18 Compatible CRM Lead Form View Customization
        
        This view restricts financial fields (expected_revenue, recurring_revenue)
        to users with 'CRM Full Access' group.
        
        Odoo 18 Form Structure Notes:
        - expected_revenue is in: div.oe_title > h2 > div.col-auto > div.d-flex > field
        - recurring_revenue follows the same pattern
        - Using groups attribute to control visibility
    -->
    <record id="view_crm_lead_form_limited" model="ir.ui.view">
        <field name="name">crm.lead.form.limited</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="crm.crm_lead_view_form"/>
        <field name="priority">99</field>
        <field name="arch" type="xml">

            <!-- Hide expected_revenue field for users without CRM Full Access -->
            <xpath expr="//field[@name='expected_revenue']" position="attributes">
                <attribute name="groups">custom_limited_crm_log_note_and_views.group_crm_full_access</attribute>
            </xpath>

            <!-- Hide recurring_revenue field for users without CRM Full Access -->
            <xpath expr="//field[@name='recurring_revenue']" position="attributes">
                <attribute name="groups">custom_limited_crm_log_note_and_views.group_crm_full_access</attribute>
            </xpath>

            <!-- Hide recurring_plan field for users without CRM Full Access -->
            <xpath expr="//field[@name='recurring_plan']" position="attributes">
                <attribute name="groups">custom_limited_crm_log_note_and_views.group_crm_full_access</attribute>
            </xpath>

            <!-- Hide the revenue label for users without CRM Full Access -->
            <xpath expr="//label[@for='expected_revenue']" position="attributes">
                <attribute name="groups">custom_limited_crm_log_note_and_views.group_crm_full_access</attribute>
            </xpath>

            <!-- Hide the entire revenue row container for cleaner UI when hidden -->
            <xpath expr="//h2/div[hasclass('col-auto')][descendant::field[@name='expected_revenue']]" position="attributes">
                <attribute name="groups">custom_limited_crm_log_note_and_views.group_crm_full_access</attribute>
            </xpath>

        </field>
    </record>
</odoo>
