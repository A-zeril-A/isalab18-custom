<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_purchase_management_form" model="ir.ui.view">
        <field name="name">purchase.management.view.form</field>
        <field name="model">purchase.management</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_to_budget_approver" string="Send To Budget Approver" class="oe_highlight" type="object" groups="purchase_management.group_purchase_admin,purchase_management.group_purchase_purchaser" invisible="state != 'purchaser_start' or exceed_budget_limit == False"/>
                    <button name="action_to_purchaser" string="Send to Purchaser" class="oe_highlight" type="object" invisible="state != 'send2res'" groups="purchase_management.group_purchase_approval,purchase_management.group_purchase_admin"/>
                    <button name="action_to_res" string="Send to Responsible" class="oe_highlight" type="object" invisible="state != 'draft'" />
                    <button name="action_done" string="Mark as done" class="oe_highlight" type="object" invisible="state != 'purchaser_start' or exceed_budget_limit == True" groups="purchase_management.group_purchase_admin,purchase_management.group_purchase_purchaser"/>
                    <button name="action_done" string="Mark as done" class="oe_highlight" type="object" invisible="state != 'buy'" groups="purchase_management.group_purchase_admin,purchase_management.group_purchase_purchaser"/>
                    <button name="action_to_buy" string="Approve Purcahse" class="oe_highlight" type="object" invisible="state != 'budget_approve'" groups="purchase_management.group_purchase_admin,purchase_management.group_purchase_budget_approver"/>
                    <button name="%(purchase_management.action_refuse_purchase)d" string="Refuse" type="action" invisible="state not in ('send2res', 'approve', 'budget_approve')" groups="purchase_management.group_purchase_approval,purchase_management.group_purchase_admin"/>
                    <button name="action_to_draft" string="Back to draft" type="object" invisible="state not in ('done', 'purchaser_start')" groups="purchase_management.group_purchase_admin,purchase_management.group_purchase_approval"/>
                    <!-- I disabled the utility to click on the states I want to do it with the buttons  options="{'clickable' : '1'}" -->
                    <field name="state" widget="statusbar"/>
                    <!-- For hiding the states we can use this command statusbar_visible="draft,invoice,done"-->
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name" readonly="is_field_readonly == True"/>
                            <field name="source_document" readonly="is_field_readonly == True"/>
                            <field name="active" invisible="1"/>
                            <field name="zlab_contact_id" readonly="is_field_readonly == True" options="{'no_create': True}"/>
                            <field name="zlab_company_id"/>
                            <field name="child_ids" invisible="1"/>
                            <field name="responsible_id" readonly="1" groups="purchase_management.group_purchase_user"/>
                            <field name="responsible_id" groups="purchase_management.group_purchase_admin"/>
                            <field name="arca_number" readonly="is_field_readonly == True"/>
                            <!--For Debug Purpose only then invisible=1-->
                            <field name="exceed_budget_limit" invisible="1"/>
                            <field name="is_field_readonly" invisible="1"/>
                        </group>
                        <group>
                            <field name="ordering_num" readonly="1"/>
                            <field name="order_date" readonly="is_field_readonly == True"/>
                            <field name="deadline_date" readonly="is_field_readonly == True"/>
                            <field name="category_ids" widget="many2many_tags" options="{'color_field': 'color'}" groups="purchase_management.group_purchase_purchaser,purchase_management.group_purchase_budget_approver,purchase_management.group_purchase_admin"/>
                            <field name="total_amount" widget="monetary" options="{'currency_field':'currency_id'}"
                                class="oe_inline"/>
                        </group>
                    </group>
                    <!-- Notebook Area -->
                    <notebook>
                        <page name="order" string="Order Lines">
                            <field name="product_line_ids"
                                widget="section_and_note_one2many">
                                <list editable="bottom">
                                     <field name="product_id" readonly="is_readonly == True"/>
                                    <field name="price_unit" widget="monetary" groups="purchase_management.group_purchase_admin,purchase_management.group_purchase_approval,purchase_management.group_purchase_purchaser"/>
                                    <field name="qty"/>
                                    <field name="currency_id" invisible="True"/>
                                    <field name="price_subtotal" sum="Totals:" widget="monetary" />
                                    <field name="is_readonly" column_invisible="1"/>
                                </list>
                                <form>
                                    <group>
                                        <field name="product_id" readonly="is_readonly == True"/>
                                        <field name="price_unit"/>
                                        <field name="qty"/>
                                        <field name="is_readonly" invisible="1"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <!-- Odoo 18 Chatter -->
                <chatter/>
            </form>
        </field>
    </record>
    <!--TREE VIEW -->
    <record id="view_purchase_management_tree" model="ir.ui.view">
        <field name="name">purchase.management.view.tree</field>
        <field name="model">purchase.management</field>
        <field name="arch" type="xml">
            <!-- Also here we can handling the auto editable-->
            <list decoration-success="state == 'done'" decoration-danger="state == 'cancel'" decoration-info="state == 'invoice'">
                <field name="name" string="Purchase Name"></field>
                <!-- Put the purchaser id view in the comment -->
                <!--      <field name="purchaser_id" widget="many2one_avatar"/> -->
                <field name="ordering_num" string="Ordering Number"></field>
                <field name="deadline_date" string="Deadline"/>
                <field name="activity_ids" widget="list_activity"/>
                <field name="state"
                decoration-success="state == 'done' or state == 'approve'"
                decoration-info="state in ('draft','invoice')"
                decoration-danger="state == 'cancel'"
                widget="badge"/>
            </list>
        </field>
    </record>
    <!-- Activity View-->
    <record id="purchase_management_view_activity" model="ir.ui.view">
        <field name="name">purchase.management.view.activity</field>
        <field name="model">purchase.management</field>
        <field name="arch" type="xml">
            <activity string="Purchase">
                <!-- Put the purchaser in the comment-->
                <!-- <field name="purchaser_id"/> -->
                <field name="name"/>
                <templates>
                    <div t-name="activity-box">
                        <field name="ordering_num"/>
                        <div style="padding:40px;">
                            <!-- 
                            <field name="purchaser_id" display="full"/>
                            -->
                    </div>
                    </div>
                </templates>
            </activity>
        </field>
    </record>
    <!-- Calendar View-->
    <record id="purchase_management_view_calendar" model="ir.ui.view">
        <field name="name">purchase.management.view.calendar</field>
        <field name="model">purchase.management</field>
        <field name="mode">primary</field>
        <field name="arch" type="xml">
            <calendar string="Purchases" date_start="order_date" date_stop="deadline_date" event_open_popup="true"
                        color="state" mode="month" event_limit="5">
                <field name="state" filters="1" invisible="1"/>
                <field name="name"/>
                <!-- 
                <field name="purchaser_id"/>-->
                <field name="ordering_num"/>

            </calendar>
        </field>
    </record>

    <!--SEARCH -->
    <record id="purchase_management_view_search" model="ir.ui.view">
        <field name="name">purchase.management.view.search</field>
        <field name="model">purchase.management</field>
        <field name="arch" type="xml">
            <search>
                <filter name="name" string="Purchase Name" domain="[('name', 'ilike', self)]" />
                <separator/>
                <filter name="filter_archived" string="Archived" domain="[('active', '=', False)]"/>
                <!-- 
                <searchpanel>
                    <field name="category_ids" string="Categories" enable_counter="1"/>
                </searchpanel> -->
            </search>
        </field>
    </record>

    <record id="action_purchase_management" model="ir.actions.act_window">
        <field name="name">Purchases</field>
        <field name="res_model">purchase.management</field>
        <field name="view_mode">list,form,activity,calendar</field>
        <field name="domain">[]</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first Purchase order
            </p>
        </field>
    </record>

    <menuitem
    id="menu_purchase_management_master"
    parent="purchase_management_root"
    action="action_purchase_management"
    name="Purcheses"
    sequence="0"/>

</odoo>
